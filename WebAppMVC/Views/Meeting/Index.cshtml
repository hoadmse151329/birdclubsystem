@model dynamic
@{
    ViewData["Title"] = "Meeting Page";
    List<BAL.ViewModels.MeetingViewModel> meetingList = Model.Meetings != null ? Model.Meetings : new List<BAL.ViewModels.MeetingViewModel>();
    List<string> roadNameList = Model.Roads != null ? Model.Roads : new List<string>();
    List<string> districtNameList = Model.Districts != null ? Model.Districts : new List<string>();
    List<string> cityNameList = Model.Cities != null ? Model.Cities : new List<string>();
}

<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="~/css/Meeting.css">
    <!-- main CSS -->
</head>
<body class="background">
    <hr>
    <div class="header__breadcrumb container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")" class="text-decoration-none">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">All Meetings</li>
            </ol>
        </nav>
    </div>
    <hr>
    <!-- CONTENT -->
    <section class="content__list-room container">
        <div class="row contain">
            <div class="content__filter col-3">
                <div class="content__filter-tabs-left">
                    <div class="tabs-left-title">
                        <h3 class="heading">Filter</h3>
                    </div>
                    <div class="tabs-left-filter" style="background-color:white">
                        <form id="filterForm">
                            @{
                                await Html.RenderPartialAsync("_MeetingRoadNameListPartial", roadNameList);
                            }
                            @{
                                await Html.RenderPartialAsync("_MeetingDistrictNameListPartial", districtNameList);
                            }
                            @{
                                await Html.RenderPartialAsync("_MeetingCityNameListPartial", cityNameList);
                            }
                        </form>
                                    <button class="toggle-btn button--primary" aria-expanded="false" aria-label="Toggle More"><span>More</span></button>
                                }
                    </div>
                    <div class="col-bg">
                        <img class="bg-1" src="~/images/meeting.png"></img>
                        <img class="bg-2" src="~/images/Club-Meeting-Minutes.jpg"></img>
                    </div>
                </div>
            </div>
            <div class="col-9">
                <div id="meeting-list" class="content__list row">
                    <!-- Render the initial meeting list -->
                    @{
                        await Html.RenderPartialAsync("_MeetingListPartial", meetingList);
                    }
                </div>
                <div class="pagination mb-3">
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
            referrerpolicy="no-referrer"></script>
    <!-- Jquery Waypoint -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
    <!-- BS4 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.5/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.form-check-input').change(function () {
                applyFilters();
            });

            function applyFilters() {
                var selectedRoads = [];
                var selectedDistricts = [];
                var selectedCities = [];

                // Collect selected checkboxes
                $('input[name="road"]:checked').each(function () {
                    selectedRoads.push($(this).val());
                });

                $('input[name="district"]:checked').each(function () {
                    selectedDistricts.push($(this).val());
                });

                $('input[name="city"]:checked').each(function () {
                    selectedCities.push($(this).val());
                });

                var queryString = customParam({
                    road: selectedRoads,
                    district: selectedDistricts,
                    city: selectedCities
                });
                console.log(queryString);

                // Make AJAX GET request to filter meetings
                $.ajax({
                    url: '@Url.Action("IndexFilter", "Meeting")' + '?' + queryString,
                    method: 'GET',
                    success: function (response) {
                        renderMeetings(response);
                    }
                });
            }

            function renderMeetings(meetingsHtml) {
                var meetingList = $('#full-filter');
                meetingList.html(meetingsHtml);
            }

            function customParam(object) {
                var serializedParams = [];

                function serialize(params, prefix) {
                    for (var key in params) {
                        if (Object.prototype.hasOwnProperty.call(params, key)) {
                            var paramKey = prefix ? prefix + "[" + key + "]" : key;
                            var paramValue = params[key];

                            if (typeof paramValue === "object") {
                                serialize(paramValue, paramKey);
                            } else {
                                serializedParams.push(
                                    encodeURIComponent(paramKey) + "=" + encodeURIComponent(paramValue)
                                );
                            }
                        }
                    }
                }

                serialize(object);

                return serializedParams.join("&");
            }
            </Script>
<Script>
            // Toggle functionality for filter checkboxes
            $('.toggle-btn').on('click', function (event) {
                event.preventDefault(); // Prevent the default behavior of the button

                var fieldset = $(this).closest('.filter-group');
                var checkBoxes = fieldset.find('.input-group');

                var isExpanded = $(this).attr('aria-expanded') === 'true';

                if (isExpanded) {
                    checkBoxes.slice(3).hide();
                    $(this).attr('aria-expanded', 'false').find('span').text('More');
                } else {
                    checkBoxes.show();
                    $(this).attr('aria-expanded', 'true').find('span').text('Less');
                }
            });
    </script>
</body>
</html>