@model dynamic
@{
    ViewData["Title"] = "Meeting Page";
    List<BAL.ViewModels.MeetingViewModel> meetingList = Model.Meetings != null ? Model.Meetings : new List<BAL.ViewModels.MeetingViewModel>();
    List<string> roadNameList = Model.Roads != null ? Model.Roads : new List<string>();
    List<string> districtNameList = Model.Districts != null ? Model.Districts : new List<string>();
    List<string> cityNameList = Model.Cities != null ? Model.Cities : new List<string>();
}

<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="~/css/Meeting.css">
    <!-- main CSS -->
</head>
<body class="background">
    <hr>
    <div class="header__breadcrumb container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")" class="text-decoration-none">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">All Meetings</li>
            </ol>
        </nav>
    </div>
    <hr>
    <!-- CONTENT -->
    <section class="content__list-room container">
        <div class="row contain">
            <div class="content__filter col-3">
                <div class="content__filter-tabs-left">
                    <div class="tabs-left-title">
                        <h3 class="heading">Filter</h3>
                    </div>
                    <div class="tabs-left-filter" style="background-color:white">
                        <form id="filterForm">
                            <fieldset class="filter-group">
                                <legend>Road</legend>
                                <div class="checkboxes">
                                    @foreach (var data in roadNameList)
                                    {
                                        <div class="input-group">
                                            <div class="form-check">
                                                <input class="form-check-input road-checkbox" type="checkbox" name="road" id="road_@data.Trim()" value="@data.Trim()">
                                                <label class="form-check-label" for="road_@data.Trim()">@data.Trim()</label>
                                            </div>
                                        </div>
                                    }
                                </div>
                                @if (roadNameList.Count() > 3)
                                {
                                    <button class="toggle-btn btn btn-primary" aria-expanded="false" aria-label="Toggle More"><span>More</span></button>
                                }
                            </fieldset>

                            <fieldset class="filter-group">
                                <legend>District</legend>
                                <div class="checkboxes">
                                    @foreach (var data in districtNameList)
                                    {
                                        <div class="input-group">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="district" id="district_@data.Trim()" value="@data.Trim()">
                                                <label class="form-check-label" for="district_@data.Trim()">@data.Trim()</label>
                                            </div>
                                        </div>
                                    }
                                </div>
                                @if (districtNameList.Count() > 3)
                                {
                                    <button class="toggle-btn btn btn-primary" aria-expanded="false" aria-label="Toggle More"><span>More</span></button>
                                }
                            </fieldset>

                            <fieldset class="filter-group">
                                <legend>City</legend>
                                <div class="checkboxes">
                                    @foreach (var data in cityNameList)
                                    {
                                        <div class="input-group">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="city" id="city_@data.Trim()" value="@data.Trim()">
                                                <label class="form-check-label" for="city_@data.Trim()">@data.Trim()</label>
                                            </div>
                                        </div>
                                    }
                                </div>
                                @if (cityNameList.Count() > 3)
                                {
                                    <button class="toggle-btn btn btn-primary" aria-expanded="false" aria-label="Toggle More"><span>More</span></button>
                                }
                            </fieldset>
                        </form>
                    </div>
                    <div class="col-bg">
                        <img class="bg-1" src="~/images/meeting.png"></img>
                        <img class="bg-2" src="~/images/Club-Meeting-Minutes.jpg"></img>
                    </div>
                </div>
            </div>
            <div class="col-9">
                <div id="meeting-list" class="content__list row">
                    <!-- Render the initial meeting list -->
                    @Html.RenderPartialAsync("_MeetingListPartial", meetingList)
                </div>
                <div class="pagination mb-3">
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
            referrerpolicy="no-referrer"></script>
    <!-- Jquery Waypoint -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
    <!-- BS4 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.5/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.form-check-input').change(function () {
                applyFilters();
            });

            function applyFilters() {
                var selectedRoads = [];
                var selectedDistricts = [];
                var selectedCities = [];

                // Collect selected checkboxes
                $('input[name="road"]:checked').each(function () {
                    selectedRoads.push($(this).val());
                });

                $('input[name="district"]:checked').each(function () {
                    selectedDistricts.push($(this).val());
                });

                $('input[name="city"]:checked').each(function () {
                    selectedCities.push($(this).val());
                });

                var queryString = $.param({
                    road: selectedRoads,
                    district: selectedDistricts,
                    city: selectedCities
                });
                console.log(queryString);

                // Make AJAX GET request to filter meetings
                $.ajax({
                    url: '@Url.Action("IndexFilter", "Meeting")?' + queryString,
                    method: 'GET',
                    success: function (response) {
                        $('#meeting-list').html(response);
                    }
                });
            }

            // Toggle functionality for filter checkboxes
            $('.toggle-btn').on('click', function (event) {
                event.preventDefault(); // Prevent the default behavior of the button

                var fieldset = $(this).closest('.filter-group');
                var checkBoxes = fieldset.find('.input-group');

                var isExpanded = $(this).attr('aria-expanded') === 'true';

                if (isExpanded) {
                    checkBoxes.slice(3).hide();
                    $(this).attr('aria-expanded', 'false').find('span').text('More');
                } else {
                    checkBoxes.show();
                    $(this).attr('aria-expanded', 'true').find('span').text('Less');
                }
            });

            // Initialize toggle button states
            $('.filter-group').each(function () {
                var checkBoxes = $(this).find('.input-group');
                if (checkBoxes.length <= 3) {
                    $(this).find('.toggle-btn').attr('aria-expanded', 'true').find('span').text('Less');
                } else {
                    checkBoxes.slice(3).hide();
                }
            });
        });
    </script>
    @* <script>
        $(document).ready(function () {
            $('.toggle-btn').on('click', function (event) {
                event.preventDefault(); // Prevent the default behavior of the button

                var fieldset = $(this).closest('.filter-group');
                var checkBoxes = fieldset.find('.input-group');

                var isExpanded = $(this).attr('aria-expanded') === 'true';

                if (isExpanded) {
                    checkBoxes.slice(3).hide();
                    $(this).attr('aria-expanded', 'false').find('span').text('More');
                } else {
                    checkBoxes.show();
                    $(this).attr('aria-expanded', 'true').find('span').text('Less');
                }
            });

            $('.filter-group').each(function () {
                var checkBoxes = $(this).find('.input-group');
                if (checkBoxes.length <= 3) {
                    $(this).find('.toggle-btn').attr('aria-expanded', 'true').find('span').text('Less');
                } else {
                    checkBoxes.slice(3).hide();
                }
            });
        });
    </script> *@
</body>
</html>